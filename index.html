<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>커플링 검색기-(주)성일기공</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            color: #1f2937;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .custom-dropdown-options::-webkit-scrollbar { width: 6px; }
        .custom-dropdown-options::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-dropdown-options::-webkit-scrollbar-thumb { background: #888; border-radius: 3px; }
        .custom-dropdown-options::-webkit-scrollbar-thumb:hover { background: #555; }
        .lang-btn.active, .view-btn.active { background-color: #3b82f6; color: white; }
        #table-view-container table th, #table-view-container table td {
            padding: 8px 12px;
            border: 1px solid #e5e7eb;
            vertical-align: middle;
            text-align: center;
        }
        #table-view-container table img {
            max-width: 60px;
            height: auto;
            margin: 0 auto;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-7xl relative">
        <div class="absolute top-4 right-4 text-xs text-gray-400 text-right">
            <div>VER-1.02</div>
            <div>(CATALOGUE 2025 VOL2.0)</div>
        </div>
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-4" data-lang-key="mainTitle">커플링 검색기-(주)성일기공</h1>
        
        <div id="lang-switcher" class="text-center mb-4 space-x-2">
            <button onclick="setLanguage('ko')" class="lang-btn px-3 py-1 text-sm border rounded-md">한국어</button>
            <button onclick="setLanguage('en')" class="lang-btn px-3 py-1 text-sm border rounded-md">English</button>
            <button onclick="setLanguage('ja')" class="lang-btn px-3 py-1 text-sm border rounded-md">日本語</button>
        </div>

        <p class="text-center text-gray-600 mb-8" data-lang-key="subTitle">
            사양을 입력하여 제품을 검색하세요.
        </p>

        <!-- 검색 필터 섹션 -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            <div>
                <label for="coupling-type" class="block text-sm font-medium text-gray-700 mb-2" data-lang-key="couplingType">제품 타입</label>
                <select id="coupling-type" class="w-full px-4 py-2 border border-gray-300 rounded-md"></select>
            </div>
            <div>
                <label for="fastening-type" class="block text-sm font-medium text-gray-700 mb-2" data-lang-key="fasteningType">체결 타입</label>
                <select id="fastening-type" class="w-full px-4 py-2 border border-gray-300 rounded-md"></select>
            </div>
            <div class="relative">
                <label for="product-code-button" class="block text-sm font-medium text-gray-700 mb-2" data-lang-key="productCode">품명</label>
                <button id="product-code-button" class="w-full px-4 py-2 bg-white border border-gray-300 rounded-md text-left flex justify-between items-center">
                    <span class="truncate" data-lang-key="all">전체</span>
                    <svg class="w-4 h-4 ml-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="product-code-dropdown" class="hidden absolute z-10 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg">
                    <input type="text" id="product-code-search" data-lang-placeholder="productCodeSearch" placeholder="품명 검색..." class="w-full px-3 py-2 border-b focus:outline-none">
                    <div id="product-code-options" class="custom-dropdown-options max-h-48 overflow-y-auto p-2"></div>
                </div>
            </div>
            <div>
                <label for="inner-dia1" class="block text-sm font-medium text-gray-700 mb-2" data-lang-key="innerDia1">내경1</label>
                <input type="number" id="inner-dia1" data-lang-placeholder="example" placeholder="예: 12" class="w-full px-4 py-2 border border-gray-300 rounded-md">
            </div>
            <div>
                <label for="inner-dia2" class="block text-sm font-medium text-gray-700 mb-2" data-lang-key="innerDia2">내경2</label>
                <input type="number" id="inner-dia2" data-lang-placeholder="example" placeholder="예: 12" class="w-full px-4 py-2 border border-gray-300 rounded-md">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" data-lang-key="outerDia">외경</label>
                <div class="flex items-center space-x-2">
                    <input type="number" id="min-outer-dia" data-lang-placeholder="min" placeholder="최소값" class="w-1/2 px-4 py-2 border rounded-md">
                    <span class="text-gray-500">~</span>
                    <input type="number" id="max-outer-dia" data-lang-placeholder="max" placeholder="최대값" class="w-1/2 px-4 py-2 border rounded-md">
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2" data-lang-key="length">길이</label>
                <div class="flex items-center space-x-2">
                    <input type="number" id="min-length" data-lang-placeholder="min" placeholder="최소값" class="w-1/2 px-4 py-2 border rounded-md">
                    <span class="text-gray-500">~</span>
                    <input type="number" id="max-length" data-lang-placeholder="max" placeholder="최대값" class="w-1/2 px-4 py-2 border rounded-md">
                </div>
            </div>
            <div>
                <label for="max-torque" class="block text-sm font-medium text-gray-700 mb-2" data-lang-key="torque">허용/상용 토크</label>
                <input type="number" id="max-torque" data-lang-placeholder="exampleTorque" placeholder="예: 5" class="w-full px-4 py-2 border rounded-md">
            </div>
            <div>
                <label for="safety-factor" class="block text-sm font-medium text-gray-700 mb-2" data-lang-key="safetyFactor">안전 계수</label>
                <input type="number" id="safety-factor" value="1" min="1" step="0.1" class="w-full px-4 py-2 border rounded-md">
            </div>
        </div>

        <div class="flex items-center justify-center mb-4">
            <input type="checkbox" id="enable-tolerance" class="h-4 w-4 text-blue-600 border-gray-300 rounded">
            <label for="enable-tolerance" class="ml-2 block text-sm text-gray-900" data-lang-key="tolerance">최대값 +10% 포함 검색 (길이, 외경)</label>
        </div>

        <div class="flex flex-col md:flex-row justify-center gap-4 mt-6">
            <button onclick="searchCouplings()" id="search-button" class="w-full md:w-auto px-8 py-3 bg-blue-600 text-white font-semibold rounded-md shadow-md" data-lang-key="search">제품 검색</button>
            <button onclick="resetForm()" id="reset-button" class="w-full md:w-auto px-8 py-3 bg-gray-300 text-gray-800 font-semibold rounded-md shadow-md" data-lang-key="reset">초기화</button>
        </div>

        <div id="results-section" class="mt-8 hidden">
            <div class="flex justify-between items-center mb-4 border-b pb-2">
                <h2 class="text-2xl font-semibold text-gray-800" data-lang-key="resultsTitle">검색 결과</h2>
                <div id="view-switcher" class="space-x-2">
                    <button onclick="setView('card')" class="view-btn px-3 py-1 text-sm border rounded-md active" data-lang-key="cardView">카드 보기</button>
                    <button onclick="setView('table')" class="view-btn px-3 py-1 text-sm border rounded-md" data-lang-key="tableView">표 보기</button>
                </div>
            </div>
            <div id="status-message" class="flex items-center justify-center p-4 text-gray-500 hidden">
                <div class="spinner mr-3"></div>
                <span id="status-text"></span>
            </div>
            <div id="card-view-container">
                <div id="results-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
            </div>
            <div id="table-view-container" class="hidden overflow-x-auto">
                <table class="w-full text-sm text-left text-gray-500">
                    <thead class="text-xs text-gray-700 bg-gray-50" style="text-transform: none;">
                        <tr id="table-header"></tr>
                    </thead>
                    <tbody id="table-body"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        let uploadedCouplings = [];
        let lastFilteredResults = [];
        let currentLanguage = 'ko';
        let currentView = 'card';
        const FIXED_GOOGLE_SHEET_URL = "https://docs.google.com/spreadsheets/d/1eWF3PI5Bk_FjSv7c-gK-mSLS6PuLGn3gm3kg806V5fA/edit?gid=0#gid=0";
        
        const translations = {
            ko: {
                locale: "ko-KR", mainTitle: "커플링 검색기-(주)성일기공", subTitle: "사양을 입력하여 제품을 검색하세요.", couplingType: "제품 타입", fasteningType: "체결 타입", productCode: "품명", all: "전체", productCodeSearch: "품명 검색...", innerDia1: "내경1", innerDia2: "내경2", example: "예: 12", outerDia: "외경", min: "최소값", max: "최대값", length: "길이", torque: "허용/상용 토크", exampleTorque: "예: 5", safetyFactor: "안전 계수", tolerance: "최대값 +10% 포함 검색 (길이, 외경)", search: "제품 검색", reset: "초기화", resultsTitle: "검색 결과", noResults: "검색 조건에 맞는 제품이 없습니다.", loading: "데이터를 불러오는 중입니다. 잠시만 기다려주세요...", loadSuccess: (c) => `${c}개의 제품 데이터를 성공적으로 불러왔습니다.`, selected: (c) => `${c}개 선택됨`, innerDiaRange: "내경 범위", torsionalStiffness: "비틀림 강성", angularMisalignment: "허용 편각", parallelMisalignment: "허용 편심", endPlay: "허용 엔드플레이", productTypeInfo: (type, fastening) => `${type || '-'} 타입 - ${fastening || '-'}`, cardView: "카드 보기", tableView: "표 보기", thImage: "이미지"
            },
            en: {
                locale: "en-US", mainTitle: "Coupling Finder - SUNGIL", subTitle: "Enter specifications to search for products.", couplingType: "Product Type", fasteningType: "Fastening Type", productCode: "Product Code", all: "All", productCodeSearch: "Search product code...", innerDia1: "Inner Dia. 1", innerDia2: "Inner Dia. 2", example: "e.g., 12", outerDia: "Outer Dia.", min: "Min", max: "Max", length: "Length", torque: "Allowable/Rated Torque", exampleTorque: "e.g., 5", safetyFactor: "Safety Factor", tolerance: "Include +10% tolerance for max values (Length, OD)", search: "Search Products", reset: "Reset", resultsTitle: "Search Results", noResults: "No products match the search criteria.", loading: "Loading data, please wait...", loadSuccess: (c) => `Successfully loaded ${c} product data.`, selected: (c) => `${c} items selected`, innerDiaRange: "Inner Dia. Range", torsionalStiffness: "Torsional Stiffness", angularMisalignment: "Allowable Angular Misalignment", parallelMisalignment: "Allowable Parallel Misalignment", endPlay: "Allowable End-Play", productTypeInfo: (type, fastening) => `${type || '-'} TYPE - ${fastening || '-'}`, cardView: "Card View", tableView: "Table View", thImage: "Image"
            },
            ja: {
                locale: "ja-JP", mainTitle: "カップリング検索機 - (株)ソンイル", subTitle: "仕様を入力して製品を検索してください。", couplingType: "製品タイプ", fasteningType: "締結タイプ", productCode: "品番", all: "すべて", productCodeSearch: "品番検索...", innerDia1: "内径1", innerDia2: "内径2", example: "例: 12", outerDia: "外径", min: "最小値", max: "最大値", length: "長さ", torque: "許容/常用トルク", exampleTorque: "例: 5", safetyFactor: "安全係数", tolerance: "最大値に+10%の公差を含めて検索（長さ、外径）", search: "製品検索", reset: "リセット", resultsTitle: "検索結果", noResults: "検索条件に合う製品がありません。", loading: "データを読み込み中です。しばらくお待ちください...", loadSuccess: (c) => `${c}件の製品データを正常に読み込みました。`, selected: (c) => `${c}件選択済み`, innerDiaRange: "内径範囲", torsionalStiffness: "ねじり剛性", angularMisalignment: "許容偏角", parallelMisalignment: "許容偏心", endPlay: "許容エンドプレイ", productTypeInfo: (type, fastening) => `${type || '-'} タイプ - ${fastening || '-'}`, cardView: "カード表示", tableView: "テーブル表示", thImage: "画像"
            }
        };

        const dom = {
            resultsContainer: document.getElementById('results-container'), statusMessageDiv: document.getElementById('status-message'), statusTextSpan: document.getElementById('status-text'), searchButton: document.getElementById('search-button'), resultsSection: document.getElementById('results-section'), couplingTypeSelect: document.getElementById('coupling-type'), fasteningTypeSelect: document.getElementById('fastening-type'), enableToleranceCheckbox: document.getElementById('enable-tolerance'), productCodeButton: document.getElementById('product-code-button'), productCodeDropdown: document.getElementById('product-code-dropdown'), productCodeSearch: document.getElementById('product-code-search'), productCodeOptions: document.getElementById('product-code-options'), cardViewContainer: document.getElementById('card-view-container'), tableViewContainer: document.getElementById('table-view-container'), tableHeader: document.getElementById('table-header'), tableBody: document.getElementById('table-body')
        };

        window.onload = () => { fetchGoogleSheetData(); setLanguage(currentLanguage); };
        
        dom.couplingTypeSelect.addEventListener('change', () => { populateFasteningTypeDropdown(); populateProductCodeDropdown(); });
        dom.fasteningTypeSelect.addEventListener('change', () => populateProductCodeDropdown());
        dom.productCodeButton.addEventListener('click', () => dom.productCodeDropdown.classList.toggle('hidden'));
        dom.productCodeSearch.addEventListener('input', () => {
            const filter = dom.productCodeSearch.value.toUpperCase();
            const labels = dom.productCodeOptions.getElementsByTagName('label');
            Array.from(labels).forEach(label => {
                const txtValue = label.textContent || label.innerText;
                label.style.display = txtValue.toUpperCase().indexOf(filter) > -1 ? "" : "none";
            });
        });
        document.addEventListener('click', (event) => {
            if (!dom.productCodeButton.contains(event.target) && !dom.productCodeDropdown.contains(event.target)) {
                dom.productCodeDropdown.classList.add('hidden');
            }
        });

        function setLanguage(lang) {
            currentLanguage = lang;
            const t = translations[lang];
            document.querySelectorAll('[data-lang-key]').forEach(el => el.textContent = t[el.dataset.langKey]);
            document.querySelectorAll('[data-lang-placeholder]').forEach(el => el.placeholder = t[el.dataset.langPlaceholder]);
            document.querySelectorAll('#lang-switcher .lang-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`#lang-switcher .lang-btn[onclick="setLanguage('${lang}')"]`).classList.add('active');
            populateDropdowns(uploadedCouplings);
            updateProductCodeButtonText();
            renderTableHeader();
            displayResults();
        }

        function setView(view) {
            currentView = view;
            document.querySelectorAll('#view-switcher .view-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`#view-switcher .view-btn[onclick="setView('${view}')"]`).classList.add('active');
            displayResults();
        }

        async function fetchGoogleSheetData() {
            showStatusMessage(translations[currentLanguage].loading, true);
            dom.searchButton.disabled = true;
            try {
                const spreadsheetId = FIXED_GOOGLE_SHEET_URL.match(/\/d\/([a-zA-Z0-9-_]+)/)[1];
                const gid = FIXED_GOOGLE_SHEET_URL.match(/gid=([0-9]+)/) ? FIXED_GOOGLE_SHEET_URL.match(/gid=([0-9]+)/)[1] : 0;
                const csvUrl = `https://docs.google.com/spreadsheets/d/${spreadsheetId}/export?format=csv&gid=${gid}`;
                const response = await fetch(csvUrl);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const csvText = await response.text();
                const data = parseCsv(csvText);
                uploadedCouplings = parseSheetData(data);
                populateDropdowns(uploadedCouplings);
                showStatusMessage(translations[currentLanguage].loadSuccess(uploadedCouplings.length), false);
                dom.searchButton.disabled = false;
                setTimeout(() => hideStatusMessage(), 3000);
            } catch (error) {
                console.error('Error fetching Google Sheet data:', error);
                showStatusMessage('데이터를 불러오는 데 실패했습니다. URL을 확인하거나, 시트가 "웹에 게시"되었는지 확인해주세요.', false);
                dom.searchButton.disabled = true;
            }
        }

        function parseCsv(csvText) {
            if (csvText.charCodeAt(0) === 0xFEFF) csvText = csvText.substring(1);
            const rows = csvText.split(/\r?\n/).filter(row => row.trim() !== '');
            return rows.map(row => {
                const cells = []; let inQuote = false, currentCell = '';
                for (let i = 0; i < row.length; i++) {
                    const char = row[i];
                    if (char === '"' && inQuote && row[i+1] === '"') { currentCell += '"'; i++; } 
                    else if (char === '"') { inQuote = !inQuote; } 
                    else if (char === ',' && !inQuote) { cells.push(currentCell.trim()); currentCell = ''; } 
                    else { currentCell += char; }
                }
                cells.push(currentCell.trim()); return cells;
            });
        }

        function parseNumber(value) {
            if (value === null || value === '' || typeof value !== 'string') return null;
            const cleanedValue = value.replace(/[^0-9.-]/g, '');
            const parsed = parseFloat(cleanedValue);
            return isNaN(parsed) ? null : parsed;
        }

        function parseSheetData(data) {
            if (data.length < 2) return [];
            const headers = data[0].map(h => h.trim());
            const colMap = {'품명': 'code', 'TYPE': 'type', '체결TYPE': 'fastening_type', '외경': 'outer_dia', '길이': 'length', '최소내경': 'min_inner_dia', '최대내경': 'max_inner_dia', '허용/상용 토크': 'torque', '비틀림강성': 'torsional_stiffness', '허용 편각': 'angular_misalignment', '허용 편심': 'parallel_misalignment', '허용 엔드플레이': 'end_play', '이미지URL': 'image_url'};
            return data.slice(1).map(row => {
                if (row.length === 0 || !row[0]) return null;
                const product = {};
                headers.forEach((header, index) => {
                    const propName = colMap[header];
                    if (propName) {
                        let value = row[index] !== undefined ? row[index].trim() : null;
                        if (['outer_dia', 'length', 'min_inner_dia', 'max_inner_dia', 'torque', 'torsional_stiffness', 'angular_misalignment', 'parallel_misalignment'].includes(propName)) {
                            product[propName] = parseNumber(value);
                        } else { product[propName] = value; }
                    }
                });
                return product;
            }).filter(p => p);
        }

        function populateDropdowns(couplings) {
            populateSelect(dom.couplingTypeSelect, couplings, 'type');
            populateFasteningTypeDropdown();
            populateProductCodeDropdown();
        }

        function populateFasteningTypeDropdown() {
            const selectedType = dom.couplingTypeSelect.value;
            let filtered = uploadedCouplings;
            if (selectedType) filtered = uploadedCouplings.filter(c => c.type === selectedType);
            populateSelect(dom.fasteningTypeSelect, filtered, 'fastening_type');
        }

        function populateSelect(selectElement, data, key) {
            const uniqueValues = [...new Set(data.map(item => item[key]))].filter(Boolean).sort();
            selectElement.innerHTML = `<option value="">${translations[currentLanguage].all}</option>`;
            uniqueValues.forEach(value => {
                const option = document.createElement('option');
                option.value = value; option.textContent = value;
                selectElement.appendChild(option);
            });
        }

        function populateProductCodeDropdown() {
            const selectedType = dom.couplingTypeSelect.value;
            const selectedFasteningType = dom.fasteningTypeSelect.value;
            let filtered = uploadedCouplings;
            if (selectedType) filtered = filtered.filter(c => c.type === selectedType);
            if (selectedFasteningType) filtered = filtered.filter(c => c.fastening_type === selectedFasteningType);
            const uniqueCodes = [...new Set(filtered.map(item => item.code))].filter(Boolean).sort();
            dom.productCodeOptions.innerHTML = '';
            uniqueCodes.forEach(code => {
                const optionDiv = document.createElement('label');
                optionDiv.className = "block px-3 py-1 hover:bg-gray-100 cursor-pointer flex items-center";
                optionDiv.innerHTML = `<input type="checkbox" class="mr-2" value="${code}"> ${code}`;
                optionDiv.addEventListener('change', updateProductCodeButtonText);
                dom.productCodeOptions.appendChild(optionDiv);
            });
            updateProductCodeButtonText();
        }

        function updateProductCodeButtonText() {
            const checked = dom.productCodeOptions.querySelectorAll('input:checked');
            const buttonText = dom.productCodeButton.querySelector('span');
            if (checked.length === 0) buttonText.textContent = translations[currentLanguage].all;
            else if (checked.length === 1) buttonText.textContent = checked[0].value;
            else buttonText.textContent = translations[currentLanguage].selected(checked.length);
        }

        function searchCouplings() {
            dom.resultsSection.classList.remove('hidden');
            const t = translations[currentLanguage];

            const innerDia1 = document.getElementById('inner-dia1').value ? parseFloat(document.getElementById('inner-dia1').value) : undefined;
            const innerDia2 = document.getElementById('inner-dia2').value ? parseFloat(document.getElementById('inner-dia2').value) : undefined;
            const minOuterDia = document.getElementById('min-outer-dia').value ? parseFloat(document.getElementById('min-outer-dia').value) : undefined;
            let maxOuterDia = document.getElementById('max-outer-dia').value ? parseFloat(document.getElementById('max-outer-dia').value) : undefined;
            const minLength = document.getElementById('min-length').value ? parseFloat(document.getElementById('min-length').value) : undefined;
            let maxLength = document.getElementById('max-length').value ? parseFloat(document.getElementById('max-length').value) : undefined;
            const maxTorque = document.getElementById('max-torque').value ? parseFloat(document.getElementById('max-torque').value) : undefined;
            const safetyFactor = document.getElementById('safety-factor').value ? parseFloat(document.getElementById('safety-factor').value) : 1;
            const type = dom.couplingTypeSelect.value;
            const fasteningType = dom.fasteningTypeSelect.value;
            const selectedCodes = Array.from(dom.productCodeOptions.querySelectorAll('input:checked')).map(cb => cb.value);

            if (dom.enableToleranceCheckbox.checked) {
                if (maxOuterDia !== undefined) maxOuterDia *= 1.1;
                if (maxLength !== undefined) maxLength *= 1.1;
            }
            const requiredTorque = (maxTorque !== undefined && safetyFactor !== 0) ? maxTorque * safetyFactor : maxTorque;

            if (uploadedCouplings.length === 0) { showStatusMessage(t.loading, true); return; }

            lastFilteredResults = uploadedCouplings.filter(c => {
                return (!type || (c.type && c.type.includes(type))) &&
                       (!fasteningType || (c.fastening_type && c.fastening_type.includes(fasteningType))) &&
                       (selectedCodes.length === 0 || selectedCodes.includes(c.code)) &&
                       (innerDia1 === undefined || (c.min_inner_dia !== null && innerDia1 >= c.min_inner_dia && innerDia1 <= c.max_inner_dia)) &&
                       (innerDia2 === undefined || (c.min_inner_dia !== null && innerDia2 >= c.min_inner_dia && innerDia2 <= c.max_inner_dia)) &&
                       (minOuterDia === undefined || (c.outer_dia !== null && c.outer_dia >= minOuterDia)) &&
                       (maxOuterDia === undefined || (c.outer_dia !== null && c.outer_dia <= maxOuterDia)) &&
                       (minLength === undefined || (c.length !== null && c.length >= minLength)) &&
                       (maxLength === undefined || (c.length !== null && c.length <= maxLength)) &&
                       (requiredTorque === undefined || (c.torque !== null && c.torque >= requiredTorque));
            });
            displayResults();
        }

        function displayResults() {
            hideStatusMessage();
            const t = translations[currentLanguage];
            if (currentView === 'card') {
                dom.cardViewContainer.classList.remove('hidden');
                dom.tableViewContainer.classList.add('hidden');
                renderCards(lastFilteredResults);
            } else {
                dom.cardViewContainer.classList.add('hidden');
                dom.tableViewContainer.classList.remove('hidden');
                renderTable(lastFilteredResults);
            }
            if (lastFilteredResults.length === 0 && dom.resultsSection.classList.contains('hidden') === false) {
                showStatusMessage(t.noResults, false);
            }
        }

        function renderCards(data) {
            dom.resultsContainer.innerHTML = '';
            const t = translations[currentLanguage];
            data.forEach(c => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-lg shadow-md hover:shadow-lg transition-shadow duration-300 border border-gray-200 flex flex-col overflow-hidden";
                const innerDiaText = (c.min_inner_dia !== null && c.max_inner_dia !== null) ? (c.min_inner_dia === c.max_inner_dia ? `${c.min_inner_dia} mm` : `${c.min_inner_dia} ~ ${c.max_inner_dia} mm`) : '-';
                const getDisplay = (val, unit) => (val !== null) ? `${val} ${unit}` : '-';
                const placeholderImg = 'https://placehold.co/400x300/e2e8f0/94a3b8?text=No+Image';
                card.innerHTML = `
                    <img src="${c.image_url || placeholderImg}" alt="${c.code || '제품 이미지'}" onerror="this.onerror=null;this.src='${placeholderImg}';" class="w-full h-40 object-contain bg-gray-50">
                    <div class="p-4 flex flex-col flex-grow">
                        <h3 class="text-lg font-bold text-gray-800 text-center">${c.code || '-'}</h3>
                        <p class="text-sm text-gray-600 mb-2 text-center">${t.productTypeInfo(c.type, c.fastening_type)}</p>
                        <div class="text-sm text-gray-700 space-y-1 mt-auto pt-2 border-t mt-2">
                            <p><span class="font-semibold">${t.innerDiaRange}:</span> ${innerDiaText}</p>
                            <p><span class="font-semibold">${t.outerDia} (mm):</span> ${getDisplay(c.outer_dia, '')}</p>
                            <p><span class="font-semibold">${t.length} (mm):</span> ${getDisplay(c.length, '')}</p>
                            <p><span class="font-semibold">${t.torque} (N·m):</span> ${getDisplay(c.torque, '')}</p>
                            <p><span class="font-semibold">${t.torsionalStiffness} (N·m/rad):</span> ${c.torsional_stiffness !== null ? c.torsional_stiffness.toLocaleString(t.locale) : '-'}</p>
                            <p><span class="font-semibold">${t.angularMisalignment} (°):</span> ${getDisplay(c.angular_misalignment, '')}</p>
                            <p><span class="font-semibold">${t.parallelMisalignment} (mm):</span> ${getDisplay(c.parallel_misalignment, '')}</p>
                            <p><span class="font-semibold">${t.endPlay} (mm):</span> ${c.end_play || '-'}</p>
                        </div>
                    </div>`;
                dom.resultsContainer.appendChild(card);
            });
        }

        function renderTable(data) {
            dom.tableBody.innerHTML = '';
            const t = translations[currentLanguage];
            const getDisplay = (val) => (val !== null) ? val : '-';
            const placeholderImg = 'https://placehold.co/400x300/e2e8f0/94a3b8?text=No+Image';
            data.forEach(c => {
                const row = dom.tableBody.insertRow();
                const innerDiaText = (c.min_inner_dia !== null && c.max_inner_dia !== null) ? (c.min_inner_dia === c.max_inner_dia ? `${c.min_inner_dia}` : `${c.min_inner_dia}~${c.max_inner_dia}`) : '-';
                row.innerHTML = `
                    <td><img src="${c.image_url || placeholderImg}" alt="${c.code}" onerror="this.onerror=null;this.src='${placeholderImg}';"></td>
                    <td>${c.code || '-'}</td>
                    <td>${c.type || '-'}</td>
                    <td>${c.fastening_type || '-'}</td>
                    <td>${innerDiaText}</td>
                    <td>${getDisplay(c.outer_dia)}</td>
                    <td>${getDisplay(c.length)}</td>
                    <td>${getDisplay(c.torque)}</td>
                    <td>${c.torsional_stiffness !== null ? c.torsional_stiffness.toLocaleString(t.locale) : '-'}</td>
                    <td>${getDisplay(c.angular_misalignment)}</td>
                    <td>${getDisplay(c.parallel_misalignment)}</td>
                    <td>${c.end_play || '-'}</td>
                `;
            });
        }
        
        function renderTableHeader() {
            const t = translations[currentLanguage];
            dom.tableHeader.innerHTML = `
                <th>${t.thImage}</th>
                <th>${t.productCode}</th>
                <th>${t.couplingType}</th>
                <th>${t.fasteningType}</th>
                <th>${t.innerDiaRange} (mm)</th>
                <th>${t.outerDia} (mm)</th>
                <th>${t.length} (mm)</th>
                <th>${t.torque} (N·m)</th>
                <th>${t.torsionalStiffness} (N·m/rad)</th>
                <th>${t.angularMisalignment} (°)</th>
                <th>${t.parallelMisalignment} (mm)</th>
                <th>${t.endPlay} (mm)</th>
            `;
        }
        
        function resetForm() {
            document.querySelectorAll('input[type=number], input[type=text]').forEach(input => input.value = '');
            document.getElementById('safety-factor').value = '1';
            dom.couplingTypeSelect.selectedIndex = 0;
            dom.fasteningTypeSelect.selectedIndex = 0;
            dom.enableToleranceCheckbox.checked = false;
            populateProductCodeDropdown();
            lastFilteredResults = [];
            displayResults();
            dom.resultsSection.classList.add('hidden');
        }

        function showStatusMessage(text, showSpinner) {
            dom.statusTextSpan.textContent = text;
            dom.statusMessageDiv.classList.remove('hidden');
            dom.statusMessageDiv.querySelector('.spinner').style.display = showSpinner ? 'block' : 'none';
        }

        function hideStatusMessage() {
            dom.statusMessageDiv.classList.add('hidden');
        }
    </script>
</body>
</html>

